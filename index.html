<!DOCTYPE html>
<html>
  <head>
    <title>1 Meter Calibration Test</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
      body { margin: 0; overflow: hidden; font-family: sans-serif; }
      #ui {
        position: fixed; top: 10px; width: 100%; text-align: center;
        color: yellow; font-weight: bold; pointer-events: none; 
        text-shadow: 2px 2px 2px black; font-size: 18px;
        z-index: 100;
      }
      #start-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); z-index: 999;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        color: white;
      }
      button {
        padding: 15px 40px; font-size: 20px; background: #28a745;
        color: white; border: none; border-radius: 50px; cursor: pointer; margin-top: 20px;
      }
    </style>
  </head>

  <body>

    <div id="start-screen">
      <h2>Calibration Fix</h2>
      <p>Marker Size: <b>17 cm</b></p>
      <p>Target Height: <b>100 cm</b></p>
      <button onclick="startAR()">Start Camera</button>
    </div>

    <div id="ui">Loading...</div>

    <a-scene 
      embedded 
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">

      <a-marker preset="hiro" id="marker" size="0.17" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
        
        <a-entity id="measure-group" position="0 0 0">
            
            <a-cylinder 
              id="pole"
              position="0 0.5 0" 
              radius="0.05" 
              height="1" 
              color="white" 
              opacity="0.3">
            </a-cylinder>

            <a-entity id="ring-container" position="0 1 0">
                <a-torus color="#00ff00" radius="0.5" radius-tubular="0.03" rotation="90 0 0"></a-torus>
                <a-text value="100 cm" color="#00ff00" align="center" position="0 0.6 0" scale="5 5 5" look-at="[camera]"></a-text>
            </a-entity>

        </a-entity>
        
        <a-box position="0 0.5 0" color="red" opacity="0.5"></a-box>

      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // === CALIBRATION SETTINGS ===
      const MARKER_SIZE_METERS = 0.17; // Your 17cm marker
      const TARGET_HEIGHT_METERS = 1.0; // We want 100cm

      function startAR() {
        document.getElementById('start-screen').style.display = 'none';
        
        // 1. Calculate the Ratio
        // Since the 3D world thinks "1 unit = 17cm", we need to scale up.
        // Ratio = 1.0m / 0.17m = approx 5.88 units
        const ratioScale = 1 / MARKER_SIZE_METERS; 
        
        // 2. Apply to the Group
        const group = document.getElementById('measure-group');
        const pole = document.getElementById('pole');
        const ring = document.getElementById('ring-container');
        const ui = document.getElementById('ui');

        // We scale the ENTIRE group so "1 unit" inside it equals "1 meter"
        group.setAttribute('scale', `${ratioScale} ${ratioScale} ${ratioScale}`);

        // Update UI to confirm
        ui.innerHTML = `Calibrated: 1 unit = ${MARKER_SIZE_METERS * 100}cm<br>Green Ring at 100cm`;
        
        // --- EXPLANATION OF VISUALS ---
        // The Red Box is NOT scaled. It should match the size of your physical marker exactly.
        // The Green Ring IS scaled. It should represent 1 true meter.
      }
    </script>
  </body>
</html>