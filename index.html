<!DOCTYPE html>
<html>
  <head>
    <title>1 Meter Precision Test</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
      body { margin: 0; overflow: hidden; font-family: sans-serif; }
      
      #start-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); z-index: 999;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        color: white;
      }
      button {
        padding: 15px 40px; font-size: 20px; background: #28a745;
        color: white; border: none; border-radius: 50px; cursor: pointer; margin-top: 20px;
      }
      #info {
        position: fixed; top: 10px; width: 100%; text-align: center; color: white;
        background: rgba(0,0,0,0.5); padding: 5px; pointer-events: none;
      }
    </style>
  </head>

  <body>

    <div id="start-screen">
      <h2>Final Calibration</h2>
      <p>Marker: <b>17 cm</b></p>
      <p>Target Height: <b>100 cm</b></p>
      <button onclick="startAR()">Start Camera</button>
    </div>

    <div id="info">Aligning to 17cm Marker...</div>

    <a-scene 
      embedded 
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">

      <a-marker preset="hiro" id="marker" size="0.17" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
        
        <a-entity id="height-marker" position="0 0 0">
            
            <a-torus color="#00ff00" radius="0.5" radius-tubular="0.02" rotation="90 0 0"></a-torus>
            
            <a-text 
                value="100 CM" 
                color="#00ff00" 
                align="center" 
                position="0 -0.5 0" 
                scale="3 3 3"
                look-at="[camera]">
            </a-text>

            <a-cylinder id="pole" color="white" radius="0.01" height="1" position="0 -0.5 0" opacity="0.5"></a-cylinder>
            
        </a-entity>

      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      function startAR() {
        document.getElementById('start-screen').style.display = 'none';
        
        // === THE MATH ===
        // Target: 1.0 meter
        // Marker: 0.17 meter
        // Formula: We need X number of 'marker-heights' to equal 1 meter.
        const targetHeight = 1.0;
        const markerSize = 0.17;
        const calculatedY = targetHeight / markerSize; // Result: ~5.88

        // === APPLY POSITION ONLY (NOT SCALE) ===
        const ringEntity = document.getElementById('height-marker');
        const pole = document.getElementById('pole');

        // Move the Ring UP to the calculated height
        ringEntity.setAttribute('position', `0 ${calculatedY} 0`);

        // Adjust the Pole to connect the gap
        // Height of pole = calculated Y
        // Position of pole = calculated Y / 2 (because cylinders grow from center)
        pole.setAttribute('height', calculatedY);
        pole.setAttribute('position', `0 -${calculatedY / 2} 0`);

        document.getElementById('info').innerHTML = `Ring Height: 100cm (Internal Units: ${calculatedY.toFixed(2)})`;
      }
    </script>
  </body>
</html>