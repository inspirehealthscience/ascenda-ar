<!DOCTYPE html>
<html>
  <head>
    <title>Growth Chart AR Scanner</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
      body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
      
      #start-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); z-index: 999;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        color: white;
      }
      #start-btn {
        padding: 15px 40px; font-size: 20px; background: #28a745;
        color: white; border: none; border-radius: 50px; cursor: pointer; margin-top: 20px;
      }

      /* Instructions for Calibration */
      .calibration-note {
        margin-top: 20px; font-size: 14px; color: #ffcc00; max-width: 80%; text-align: center;
      }
    </style>
  </head>

  <body>

    <script>
      const growthData = {
        sd3_pos: 1.21,  // +3 SD (121 cm)
        median:  1.10,  // Median (110 cm)
        sd3_neg: 0.99   // -3 SD (99 cm)
      };
    </script>

    <div id="start-screen">
      <h2>Growth Scanner v4</h2>
      <p>1. Place Hiro marker on floor.</p>
      <p>2. Stand back 1-2 meters.</p>
      
      <div class="calibration-note">
        IMPORTANT: This code assumes your printed black square is exactly <b>10cm (0.1m)</b> wide.<br>
        If heights are wrong, update the 'size' in the code.
      </div>

      <button id="start-btn" onclick="startAR()">Start Camera</button>
    </div>

    <a-scene 
      embedded 
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">

      <a-marker preset="hiro" id="marker" size="0.17" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
        
        <a-entity id="ring-top" position="0 1 0">
            <a-torus color="orange" radius="0.3" radius-tubular="0.015" rotation="90 0 0" opacity="0.9"></a-torus>
            <a-text id="txt-top" value="+3 SD" color="orange" align="center" position="0 0.4 0" scale="2 2 2" look-at="[camera]"></a-text>
        </a-entity>

        <a-entity id="ring-mid" position="0 1 0">
            <a-torus color="#00ff00" radius="0.3" radius-tubular="0.025" rotation="90 0 0"></a-torus>
            <a-cylinder color="#00ff00" height="0.1" radius="0.3" opacity="0.1"></a-cylinder>
            <a-text id="txt-mid" value="MEDIAN" color="#00ff00" align="center" position="0 0.4 0" scale="2 2 2" look-at="[camera]"></a-text>
        </a-entity>

        <a-entity id="ring-bot" position="0 1 0">
            <a-torus color="orange" radius="0.3" radius-tubular="0.015" rotation="90 0 0" opacity="0.9"></a-torus>
            <a-text id="txt-bot" value="-3 SD" color="orange" align="center" position="0 0.4 0" scale="2 2 2" look-at="[camera]"></a-text>
        </a-entity>
        
        <a-cylinder position="0 0.6 0" radius="0.005" height="1.2" color="white" opacity="0.3"></a-cylinder>

      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      function startAR() {
        document.getElementById('start-screen').style.display = 'none';
        
        const topRing = document.querySelector('#ring-top');
        const midRing = document.querySelector('#ring-mid');
        const botRing = document.querySelector('#ring-bot');

        topRing.setAttribute('position', `0 ${growthData.sd3_pos} 0`);
        midRing.setAttribute('position', `0 ${growthData.median} 0`);
        botRing.setAttribute('position', `0 ${growthData.sd3_neg} 0`);

        document.querySelector('#txt-top').setAttribute('value', `+3 SD (${(growthData.sd3_pos*100).toFixed(0)}cm)`);
        document.querySelector('#txt-mid').setAttribute('value', `MEDIAN (${(growthData.median*100).toFixed(0)}cm)`);
        document.querySelector('#txt-bot').setAttribute('value', `-3 SD (${(growthData.sd3_neg*100).toFixed(0)}cm)`);
      }
    </script>
  </body>
</html>