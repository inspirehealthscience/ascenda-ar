<!DOCTYPE html>
<html>
  <head>
    <title>Growth Chart AR Scanner</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
      body { margin: 0; overflow: hidden; font-family: sans-serif; }
      
      /* The Overlay UI */
      #overlay {
        position: fixed;
        bottom: 20px;
        left: 0;
        width: 100%;
        text-align: center;
        z-index: 10;
        pointer-events: none;
      }
      
      /* Start Button Screen */
      #start-screen {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9);
        z-index: 999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
      }
      
      #start-btn {
        padding: 15px 30px;
        font-size: 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 20px;
      }

      /* Legend Badges */
      .badge {
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        font-size: 16px;
        display: inline-block;
      }
      .dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
    </style>
  </head>

  <body>

    <div id="start-screen">
      <h2>AR Growth Scanner</h2>
      <p>Please allow camera access when prompted.</p>
      <button id="start-btn" onclick="startAR()">Start Camera</button>
    </div>

    <div id="overlay" style="display:none;"> <div class="badge">
        <span style="margin-right:15px;"><span class="dot" style="background:orange;"></span>Â±3 SD</span>
        <span><span class="dot" style="background:#00ff00;"></span>Median</span>
      </div>
    </div>

    <a-scene 
      embedded 
      vr-mode-ui="enabled: false"
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">

      <a-marker preset="hiro" id="marker">
        
        <a-entity position="0 1.2 0">
            <a-torus color="orange" radius="0.3" radius-tubular="0.01" rotation="90 0 0" opacity="0.8"></a-torus>
            <a-text value="+3 SD" color="orange" align="center" position="0 0.4 0" scale="2 2 2" look-at="[camera]"></a-text>
        </a-entity>

        <a-entity position="0 1.1 0">
            <a-torus color="#00ff00" radius="0.3" radius-tubular="0.02" rotation="90 0 0"></a-torus>
            <a-cylinder color="#00ff00" height="0.05" radius="0.3" opacity="0.15"></a-cylinder>
            <a-text value="MEDIAN" color="#00ff00" align="center" position="0 0.4 0" scale="2 2 2" look-at="[camera]"></a-text>
        </a-entity>

        <a-entity position="0 1.0 0">
            <a-torus color="orange" radius="0.3" radius-tubular="0.01" rotation="90 0 0" opacity="0.8"></a-torus>
            <a-text value="-3 SD" color="orange" align="center" position="0 0.4 0" scale="2 2 2" look-at="[camera]"></a-text>
        </a-entity>
        
        <a-box position="0 0 0" scale="0.1 0.01 0.1" color="blue"></a-box>

      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      function startAR() {
        // Hide start screen
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('overlay').style.display = 'block';
        
        // This triggers the scene to actually render, helping with the 'first load' bug
        document.querySelector('a-scene').style.display = 'block';
      }
    </script>
  </body>
</html>